require "stdlib"

fname = "xxx.h5"
Nc = 3

L = qcd.lattice{2,3,4}
v = L:DiracPropagatorN(Nc)
w = qcd.DiracPropagatorN(Nc)
for ca = 0, Nc - 1 do
   for da = 0, qcd.Ns - 1 do
      local V = qcd.DiracFermionN(Nc)
      for cb = 0, Nc - 1 do
         for db = 0, qcd.Ns - 1 do
            V[{c=cb,d=db}] = complex(ca+0.1*cb, da+0.1*db)
         end
      end
      w[{c=ca,d=da}] = V
   end
end
v[{0,1,2}] = w

os.remove(fname)
x = qcd.hdf5.Writer(fname)
x:write("/sample/serial/dirprop-D", w)
x:write("/sample/serial/dirprop-F", w, {precision = "float"})
x:write("/sample/lattice/dirprop-D", v)
x:write("/sample/lattice/dirprop-F", -v, {precision = "float"})
x:close()
printf("DONE\n")